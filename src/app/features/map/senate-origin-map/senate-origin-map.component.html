<div class="app-container">
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <div class="nav-left">
      <h1 class="app-title">
        <i class="fas fa-university animate-pulse"></i>
        {{ 'Senat RDC' }}
      </h1>
      <div class="nav-tabs">
        <button class="nav-tab" [class.active]="activeTab === 'map'" (click)="setActiveTab('map')">
          <i class="fas fa-map-marked-alt tab-icon animate-bounce-gentle"></i>
          {{ translate('nav.map') || 'Map' }}
        </button>
        <button class="nav-tab" [class.active]="activeTab === 'analytics'" (click)="setActiveTab('analytics')">
          <i class="fas fa-chart-bar tab-icon"></i>
          {{ translate('nav.analytics') || 'Analytics' }}
        </button>
        <button class="nav-tab" [class.active]="activeTab === 'constitution'" (click)="setActiveTab('constitution')">
          <i class="fas fa-scroll tab-icon animate-fade-in"></i>
          {{ translate('nav.constitution') || 'Constitution' }}
        </button>
        <button class="nav-tab" [class.active]="activeTab === 'news'" (click)="setActiveTab('news')">
          <i class="fas fa-newspaper tab-icon animate-pulse"></i>
          {{ translate('nav.news') || 'News' }}
        </button>
      </div>
    </div>
    
    <!-- Random Senator Pictures -->
    <div class="nav-senators" [class.hidden-mobile]="isMobileView">
      <div class="nav-senators-container">
        <div class="senator-avatars">
          <div 
            *ngFor="let senator of randomNavSenators; trackBy: getSenatorId" 
            class="nav-senator-avatar"
            (click)="onRandomSenatorClick(senator)"
            [title]="senator.fullName + ' - ' + senator.originProvince"
            [attr.aria-label]="'Senator ' + senator.fullName">
            <img
              [src]="senator.photo"
              [alt]="senator.fullName"
              (error)="onImageError($event)"
              class="senator-nav-image">
          </div>
        </div>
        <button 
          class="refresh-senators-btn"
          (click)="refreshRandomSenators()"
          title="Show different senators"
          [attr.aria-label]="'Refresh random senators'">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
    </div>
    
    <div class="nav-right">
      <!-- Language Switcher in Navigation -->
      <div class="nav-language-switcher">
        <i class="fas fa-globe-americas"></i>
        <select
          [value]="currentLanguage"
          (change)="changeLanguage($any($event.target).value)"
          class="nav-language-select"
          [attr.aria-label]="translate('language.select') || 'Language'">
          <option *ngFor="let lang of availableLanguages" [value]="lang.code">
            {{ lang.name }}
          </option>
        </select>
      </div>
      
      <!-- Theme Toggle -->
      <app-theme-toggle></app-theme-toggle>
      
      <!-- Mobile Language Switcher (visible on mobile) -->
      <div class="mobile-language-switcher-nav" *ngIf="isMobileView">
        <i class="fas fa-globe-americas"></i>
        <select
          [value]="currentLanguage"
          (change)="changeLanguage($any($event.target).value)"
          class="mobile-nav-language-select"
          [attr.aria-label]="translate('language.select') || 'Language'">
          <option *ngFor="let lang of availableLanguages" [value]="lang.code">
            {{ lang.name }}
          </option>
        </select>
      </div>
      
      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" 
              *ngIf="isMobileView" 
              (click)="toggleMobileMenu()"
              [attr.aria-expanded]="showMobileMenu"
              aria-label="Toggle navigation menu">
        <i class="fas" [class.fa-bars]="!showMobileMenu" [class.fa-times]="showMobileMenu"></i>
      </button>
      
      <div class="nav-controls" [class.hidden-mobile]="isMobileView">
        <button class="nav-btn" title="Notifications">
          <i class="fas fa-bell animate-swing"></i>
        </button>
        <button class="nav-btn" title="Settings">
          <i class="fas fa-cog animate-spin-slow"></i>
        </button>
        <button class="nav-btn" title="User Profile">
          <i class="fas fa-user-circle animate-glow"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation Menu -->
  <div class="mobile-nav-overlay" 
       *ngIf="isMobileView && showMobileMenu" 
       (click)="closeMobileMenu()"></div>
       
  <div class="mobile-nav-menu" 
       *ngIf="isMobileView" 
       [class.active]="showMobileMenu">
    <div class="mobile-nav-header">
      <h3>{{ translate('nav.navigation') || 'Navigation' }}</h3>
      <button class="mobile-nav-close" 
              (click)="closeMobileMenu()"
              aria-label="Close navigation menu">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="mobile-nav-content">
      <button class="mobile-nav-item" 
              [class.active]="activeTab === 'map'"
              (click)="setActiveTabAndCloseMenu('map')">
        <i class="fas fa-map-marked-alt"></i>
        <span>{{ translate('nav.map') || 'Map' }}</span>
        <i class="fas fa-chevron-right" *ngIf="activeTab === 'map'"></i>
      </button>
      
      <button class="mobile-nav-item" 
              [class.active]="activeTab === 'analytics'"
              (click)="setActiveTabAndCloseMenu('analytics')">
        <i class="fas fa-chart-bar"></i>
        <span>{{ translate('nav.analytics') || 'Analytics' }}</span>
        <i class="fas fa-chevron-right" *ngIf="activeTab === 'analytics'"></i>
      </button>
      
      <button class="mobile-nav-item" 
              [class.active]="activeTab === 'constitution'"
              (click)="setActiveTabAndCloseMenu('constitution')">
        <i class="fas fa-scroll"></i>
        <span>{{ translate('nav.constitution') || 'Constitution' }}</span>
        <i class="fas fa-chevron-right" *ngIf="activeTab === 'constitution'"></i>
      </button>
      
      <button class="mobile-nav-item" 
              [class.active]="activeTab === 'news'"
              (click)="setActiveTabAndCloseMenu('news')">
        <i class="fas fa-newspaper"></i>
        <span>{{ translate('nav.news') || 'News' }}</span>
        <i class="fas fa-chevron-right" *ngIf="activeTab === 'news'"></i>
      </button>
    </div>
    
    <div class="mobile-nav-footer">
      <!-- Mobile Random Senators -->
      <div class="mobile-nav-senators" *ngIf="randomNavSenators.length > 0">
        <div class="mobile-senators-header">Featured Senators</div>
        <div class="mobile-senator-avatars">
          <div 
            *ngFor="let senator of randomNavSenators; trackBy: getSenatorId" 
            class="mobile-nav-senator-avatar"
            (click)="onRandomSenatorClick(senator); closeMobileMenu()"
            [title]="senator.fullName">
            <img
              [src]="senator.photo"
              [alt]="senator.fullName"
              (error)="onImageError($event)"
              class="mobile-senator-nav-image">
            <div class="mobile-senator-name">{{ senator.fullName.split(' ')[0] }}</div>
          </div>
          <button 
            class="mobile-refresh-senators-btn"
            (click)="refreshRandomSenators()"
            title="Show different senators">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>
      
      <div class="mobile-language-switcher">
        <i class="fas fa-globe-americas"></i>
        <select
          [value]="currentLanguage"
          (change)="changeLanguage($any($event.target).value)"
          class="mobile-language-select">
          <option *ngFor="let lang of availableLanguages" [value]="lang.code">
            {{ lang.name }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <div class="main-layout">
    <!-- Map Section -->
    <div class="map-section" *ngIf="activeTab === 'map'">
      <div id="origin-map-host">
        <div class="map-container" 
             (click)="onMapContainerClick($event)"
             (touchstart)="onTouchStart($event)"
             (touchend)="onTouchEnd($event)">
          <div *ngIf="!mapLayerData" class="loading-state">
            <p>{{ translate('loading.mapData') }}</p>
          </div>

          <div *ngIf="mapLayerData" class="map-content">
            <!-- Mobile Legend Info Button -->
            <button class="mobile-legend-button" 
                    *ngIf="isMobileView && activeTab === 'map'"
                    (click)="showMobileLegend = !showMobileLegend"
                    [class.active]="showMobileLegend"
                    title="Show color scale">
              <i class="fas fa-palette"></i>
            </button>
            
            <!-- Mobile Legend Popup -->
            <div class="mobile-legend-popup" 
                 *ngIf="isMobileView && showMobileLegend && activeTab === 'map'"
                 (click)="showMobileLegend = false">
              <div class="mobile-legend-content" (click)="$event.stopPropagation()">
                <div class="mobile-legend-header">
                  <h4>{{ translate('map.senatorsPerProvince') || 'Senators per Province' }}</h4>
                  <button class="mobile-legend-close" (click)="showMobileLegend = false">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="mobile-legend-scale">
                  <div class="scale-item" *ngFor="let item of getLegendItems()">
                    <div class="scale-color" [style.background-color]="item.color"></div>
                    <span class="scale-label">{{ item.label }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <highcharts-chart
              [Highcharts]="Highcharts"
              [constructorType]="chartConstructor"
              [options]="chartOptions"
              [update]="updateFlag"
              [callbackFunction]="chartCallback"
              style="width: 100%; height: 100%; display: block;"
            ></highcharts-chart>
          </div>

          <div *ngIf="mapLayerData && !isMapReady" class="loading-overlay">
            <p>{{ translate('loading.initializing') }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Constitution Section -->
    <div class="constitution-section" *ngIf="activeTab === 'constitution'">
      <div class="constitution-container">
        <div class="constitution-header">
          <h2 class="constitution-title">
            <i class="fas fa-scroll animate-pulse"></i>
            {{ translate('constitution.title') || 'Constitution of the Democratic Republic of Congo' }}
          </h2>
          <p class="constitution-subtitle">
            {{ translate('constitution.subtitle') || 'Senate: Composition and Powers' }}
          </p>
        </div>

        <div class="constitution-content">
          <!-- Senate Composition Section -->
          <div class="constitution-article">
            <h3 class="article-title">
              <i class="fas fa-users"></i>
              {{ translate('constitution.composition.title') || 'Senate Composition' }}
            </h3>
            <div class="article-content">
              <h4>{{ translate('constitution.composition.article98') || 'Article 98' }}</h4>
              <p>{{ translate('constitution.composition.content98') || 'The Senate is composed of senators elected for a term of five years renewable.' }}</p>
              
              <h4>{{ translate('constitution.composition.article99') || 'Article 99' }}</h4>
              <p>{{ translate('constitution.composition.content99') || 'Each province elects four senators. The city of Kinshasa elects eight senators.' }}</p>
              
              <h4>{{ translate('constitution.composition.article100') || 'Article 100' }}</h4>
              <p>{{ translate('constitution.composition.content100') || 'The senators are elected by the provincial assemblies and the council of the city of Kinshasa by indirect universal suffrage.' }}</p>
            </div>
          </div>

          <!-- Senate Powers Section -->
          <div class="constitution-article">
            <h3 class="article-title">
              <i class="fas fa-gavel"></i>
              {{ translate('constitution.powers.title') || 'Senate Powers' }}
            </h3>
            <div class="article-content">
              <h4>{{ translate('constitution.powers.article101') || 'Article 101' }}</h4>
              <p>{{ translate('constitution.powers.content101') || 'The Senate exercises legislative power concurrently with the National Assembly.' }}</p>
              
              <h4>{{ translate('constitution.powers.article102') || 'Article 102' }}</h4>
              <p>{{ translate('constitution.powers.content102') || 'The Senate has specific powers including the trial of the President of the Republic in case of high treason.' }}</p>
            </div>
          </div>

          <!-- Senate Organization Section -->
          <div class="constitution-article">
            <h3 class="article-title">
              <i class="fas fa-sitemap"></i>
              {{ translate('constitution.organization.title') || 'Senate Organization' }}
            </h3>
            <div class="article-content">
              <h4>{{ translate('constitution.organization.article103') || 'Article 103' }}</h4>
              <p>{{ translate('constitution.organization.content103') || 'The Senate elects its President and other members of its Bureau at the beginning of the legislature.' }}</p>
              
              <h4>{{ translate('constitution.organization.article104') || 'Article 104' }}</h4>
              <p>{{ translate('constitution.organization.content104') || 'The Senate establishes its internal regulations which determine its organization and functioning.' }}</p>
            </div>
          </div>

          <!-- Current Senate Statistics -->
          <div class="constitution-article">
            <h3 class="article-title">
              <i class="fas fa-chart-pie"></i>
              {{ translate('constitution.statistics.title') || 'Current Senate Statistics' }}
            </h3>
            <div class="article-content">
              <div class="statistics-grid">
                <div class="stat-card">
                  <div class="stat-number">{{ getTotalSenators() }}</div>
                  <div class="stat-label">{{ translate('constitution.statistics.totalSenators') || 'Total Senators' }}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">{{ getProvincesCount() }}</div>
                  <div class="stat-label">{{ translate('constitution.statistics.provinces') || 'Provinces' }}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">5</div>
                  <div class="stat-label">{{ translate('constitution.statistics.termYears') || 'Term Years' }}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number">{{ getFemaleSenatorsCount() }}</div>
                  <div class="stat-label">{{ translate('constitution.statistics.femalePercentage') || 'Female %' }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- News Section -->
    <div class="news-section-container" *ngIf="activeTab === 'news'">
      <app-news-section></app-news-section>
    </div>

    <!-- Enhanced Senators Sidebar -->
    <div class="senators-sidebar" *ngIf="activeTab === 'map'">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <h3 class="sidebar-title">
          <i class="fas fa-users animate-fade-in"></i>
          {{ translate('sidebar.senators') || 'Senators' }}
        </h3>
        <div class="filter-container">
          <i class="fas fa-search filter-icon animate-pulse-subtle"></i>
          <input
            type="text"
            class="filter-input"
            [placeholder]="translate('sidebar.filterPlaceholder') || 'Filter Senators...'"
            [value]="filterText"
            (input)="onFilterChange($event)">
        </div>
        
        <!-- Sorting Controls -->
        <div class="sort-container">
          <label class="sort-label">{{ translate('sidebar.sortBy') || 'Sort by' }}:</label>
          <div class="sort-controls">
            <select 
              class="sort-select"
              [value]="sortBy"
              (change)="onSortChange($any($event.target).value)"
              [attr.aria-label]="translate('sidebar.sortBy') || 'Sort by'">
              <option value="name">{{ translate('sidebar.sortName') || 'Name' }}</option>
              <option value="province">{{ translate('sidebar.sortProvince') || 'Province' }}</option>
              <option value="party">{{ translate('sidebar.sortParty') || 'Party' }}</option>
            </select>
            <button 
              class="sort-direction-btn"
              (click)="onSortChange(sortBy)"
              [attr.aria-label]="sortDirection === 'asc' ? (translate('sidebar.sortAsc') || 'A-Z') : (translate('sidebar.sortDesc') || 'Z-A')"
              [title]="sortDirection === 'asc' ? (translate('sidebar.sortAsc') || 'A-Z') : (translate('sidebar.sortDesc') || 'Z-A')">
              <i class="fas" [class.fa-sort-alpha-down]="sortDirection === 'asc'" [class.fa-sort-alpha-up]="sortDirection === 'desc'"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Senators Count -->
      <div class="senators-count">
        {{ filteredSenators.length }} {{ translate('sidebar.senatorsFound') || 'senators found' }}
      </div>

      <!-- Enhanced Senators List -->
      <div class="senators-list-container">
        <button *ngFor="let senator of filteredSenators; trackBy: getSenatorId"
                class="senator-list-item"
                [class.active]="selectedSenatorId === senator.fullName"
                (click)="selectSenator(senator)"
                [attr.aria-label]="'Select senator ' + senator.fullName">

          <img
            [src]="senator.photo || 'assets/images/default-senator.svg'"
            [alt]="senator.fullName"
            (error)="onImageError($event)"
            class="senator-avatar">

          <div class="senator-details">
            <h4 class="senator-full-name">{{ senator.fullName }}</h4>
            <p class="senator-province">{{ senator.originProvince }}</p>
          </div>

          <div class="senator-status"></div>
        </button>

        <div *ngIf="filteredSenators.length === 0" class="no-results">
          {{ translate('sidebar.noResults') || 'No senators found matching your search.' }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for showing senators per region -->
<div class="modal-overlay"
     *ngIf="showModal"
     (click)="closeModal()">
  <div class="modal-content"
       (click)="$event.stopPropagation()"
       role="dialog"
       aria-modal="true">
    <div class="modal-header">
      <h3>{{ selectedRegion?.name }} - {{ translate('modal.senateInfo') }}</h3>
      <button class="close-button"
              (click)="closeModal()"
              aria-label="Close modal">&times;</button>
    </div>

    <div class="modal-body">
      <div class="region-info">
        <p><strong>{{ translate('modal.province') }}:</strong> {{ selectedRegion?.province }}</p>
        <p><strong>{{ translate('modal.totalSenators') }}:</strong> {{ selectedRegion?.senators }}</p>
      </div>

      <div class="senators-list" *ngIf="regionSenators.length > 0">
        <h4>{{ translate('modal.senatorsFromRegion') }}:</h4>
        <div class="senators-grid">
          <div *ngFor="let senator of regionSenators" class="senator-card">
            <div class="senator-photo">
              <img
                [src]="senator.photo || 'assets/images/default-senator.svg'"
                [alt]="senator.fullName"
                (error)="onImageError($event)"
                class="photo-img">
            </div>
            <div class="senator-info">
              <strong class="senator-name">{{ senator.fullName }}</strong>
              <span class="senator-party">{{ senator.party || translate('modal.independent') }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="no-senators" *ngIf="regionSenators.length === 0">
        <p>{{ translate('modal.noSenators') }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary" (click)="closeModal()">{{ translate('modal.close') }}</button>
    </div>
  </div>
</div>

<!-- Senator Profile Modal -->
<div class="profile-modal-overlay" 
     *ngIf="selectedSenator" 
     (click)="deselectSenator()">
  <div class="profile-modal-content" 
       (click)="$event.stopPropagation()" 
       role="dialog" 
       aria-modal="true"
       [attr.aria-label]="'Senator profile for ' + selectedSenator?.fullName">
    
    <button class="profile-modal-close" 
            (click)="deselectSenator()" 
            aria-label="Close senator profile">
      <i class="fas fa-times"></i>
    </button>

    <div class="profile-modal-body">
      <img
        [src]="selectedSenator.photo || 'assets/images/default-senator.svg'"
        [alt]="selectedSenator.fullName"
        (error)="onImageError($event)"
        class="profile-avatar">

      <div class="profile-name">{{ selectedSenator.fullName }}</div>
      <div class="profile-title">{{ selectedSenator.party || translate('modal.independent') }}</div>
      <div class="profile-province">{{ translate('modal.province') }}: {{ selectedSenator.originProvince }}</div>

      <div class="profile-stats">
        <div class="stat">
          <span class="stat-value">{{ getRandomStat('distance') }}K</span>
          <span class="stat-label">{{ translate('profile.distance') || 'Distance' }}</span>
        </div>
        <div class="stat">
          <span class="stat-value">{{ getRandomStat('rating') }}</span>
          <span class="stat-label">{{ translate('profile.rating') || 'Rating' }}</span>
        </div>
      </div>

      <div class="profile-timeline">
        <div class="timeline-header">{{ translate('profile.today') || 'TODAY' }}</div>
        <div class="timeline-bars">
          <div class="timeline-bar blue"></div>
          <div class="timeline-bar green"></div>
          <div class="timeline-bar yellow"></div>
          <div class="timeline-bar blue"></div>
          <div class="timeline-bar green"></div>
        </div>
        <div class="timeline-labels">
          <span>9am</span>
          <span>12pm</span>
          <span>3pm</span>
          <span>6pm</span>
        </div>
      </div>
    </div>
  </div>
</div>
